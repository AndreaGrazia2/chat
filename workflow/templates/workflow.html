<!DOCTYPE html>
<html lang="it" class="light">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Workflow Editor</title>
	<link href="https://unpkg.com/tailwindcss@^2.2/dist/tailwind-dark.min.css" rel="stylesheet">
	<link href="/workflow/static/css/workflow.css" rel="stylesheet">
</head>

<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
	<div class="flex flex-col h-screen">
		<!-- Toolbar -->
		<div class="bg-gray-800 dark:bg-gray-950 text-white p-3 flex justify-between items-center">
			<div class="text-xl font-bold">Workflow Editor</div>
			<div class="flex space-x-3 items-center">
				<button id="theme-toggle"
					class="p-2 bg-gray-700 dark:bg-gray-800 rounded-full hover:bg-gray-600 dark:hover:bg-gray-700">
					<svg id="sun-icon" class="w-5 h-5 hidden" xmlns="http://www.w3.org/2000/svg" fill="none"
						viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
							d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" />
					</svg>
					<svg id="moon-icon" class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none"
						viewBox="0 0 24 24" stroke="currentColor">
						<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
							d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z" />
					</svg>
				</button>
				<button id="save-btn"
					class="px-3 py-1 bg-blue-600 dark:bg-blue-700 rounded hover:bg-blue-700 dark:hover:bg-blue-800 transition-colors duration-200">Save</button>
				<label
					class="px-3 py-1 bg-gray-600 dark:bg-gray-700 rounded hover:bg-gray-700 dark:hover:bg-gray-600 cursor-pointer transition-colors duration-200">
					Load
					<input type="file" class="hidden" id="load-file" accept=".json">
				</label>
				<button id="clear-all-btn"
					class="px-3 py-1 bg-red-600 dark:bg-red-700 rounded hover:bg-red-700 dark:hover:bg-red-800 transition-colors duration-200">Clear
					All</button>
				<button id="validate-btn"
					class="px-3 py-1 bg-green-600 dark:bg-green-700 rounded hover:bg-green-700 dark:hover:bg-green-800 transition-colors duration-200">Validate</button>
			</div>
		</div>

		<div class="workflow-container flex flex-1 overflow-hidden">
			<!-- Palette -->
			<div
				class="palette w-64 bg-gray-100 dark:bg-gray-800 p-4 overflow-y-auto border-r border-gray-300 dark:border-gray-700 transition-colors duration-200">
				<h3 class="font-bold text-lg mb-3 text-gray-800 dark:text-white transition-colors duration-200">Blocks
				</h3>

				<div class="category-title">TRIGGERS</div>
				<div class="node-item" draggable="true" data-type="trigger" data-name="Schedule">
					<span class="badge trigger">trigger</span>
					<div class="node-title">Schedule</div>
					<div class="node-desc">Trigger on a schedule</div>
				</div>
				<div class="node-item" draggable="true" data-type="trigger" data-name="Webhook">
					<span class="badge trigger">trigger</span>
					<div class="node-title">Webhook</div>
					<div class="node-desc">Trigger on API call</div>
				</div>

				<div class="category-title">ACTIONS</div>
				<div class="node-item" draggable="true" data-type="action" data-name="LLM Query">
					<span class="badge action">action</span>
					<div class="node-title">LLM Query</div>
					<div class="node-desc">Send query to an LLM</div>
				</div>
				<div class="node-item" draggable="true" data-type="action" data-name="Transform">
					<span class="badge action">action</span>
					<div class="node-title">Transform</div>
					<div class="node-desc">Transform data</div>
				</div>

				<div class="category-title">CONDITIONS</div>
				<div class="node-item" draggable="true" data-type="condition" data-name="Condition">
					<span class="badge condition">condition</span>
					<div class="node-title">Condition</div>
					<div class="node-desc">Branch based on condition</div>
				</div>

				<div class="category-title">OUTPUTS</div>
				<div class="node-item" draggable="true" data-type="output" data-name="API Call">
					<span class="badge output">output</span>
					<div class="node-title">API Call</div>
					<div class="node-desc">Call external API</div>
				</div>
				<div class="node-item" draggable="true" data-type="output" data-name="Email">
					<span class="badge output">output</span>
					<div class="node-title">Email</div>
					<div class="node-desc">Send an email</div>
				</div>
			</div>

			<!-- Canvas -->
			<div class="canvas" id="workflow-canvas">
			</div>

			<!-- Configuration Panel (hidden by default) -->
			<div class="config-panel hidden w-80 bg-gray-100 dark:bg-gray-800 p-4 overflow-y-auto border-l border-gray-300 dark:border-gray-700 transition-colors duration-200"
				id="config-panel">
				<div class="flex justify-between items-center mb-4">
					<h3 class="text-lg font-medium text-gray-800 dark:text-white transition-colors duration-200"
						id="config-title">Block Settings</h3>
					<button id="close-config"
						class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors duration-200">&times;</button>
				</div>

				<div class="space-y-4">
					<div>
						<label
							class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1 transition-colors duration-200">Name</label>
						<input type="text" id="node-name"
							class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-gray-700 text-gray-900 dark:text-white transition-colors duration-200">
					</div>

					<div id="type-specific-config"></div>

					<div class="pt-4">
						<button id="save-config"
							class="w-full bg-blue-600 dark:bg-blue-700 text-white p-2 rounded hover:bg-blue-700 dark:hover:bg-blue-800 transition-colors duration-200">
							Save Configuration
						</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Pulsante cestino fisso, visibile solo con config panel aperto -->
	<div class="fixed top-20 right-4 z-50 hidden" id="delete-btn-container">
		<button id="delete-node-btn" class="p-2 bg-red-600 text-white rounded hover:bg-red-700">
			<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24"
				stroke="currentColor">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
					d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
			</svg>
		</button>
	</div>

	<!-- Confirmation Modal -->
	<div id="confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
		<div class="bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6 max-w-md mx-auto transition-colors duration-200">
			<h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4 transition-colors duration-200"
				id="modal-title">Confirm Action</h3>
			<p class="text-gray-700 dark:text-gray-300 mb-6 transition-colors duration-200" id="modal-message">Are you
				sure you want to perform this action?</p>
			<div class="flex justify-end space-x-3">
				<button id="cancel-btn"
					class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white rounded hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors duration-200">Cancel</button>
				<button id="confirm-btn"
					class="px-4 py-2 bg-red-600 dark:bg-red-700 text-white rounded hover:bg-red-700 dark:hover:bg-red-800 transition-colors duration-200">Confirm</button>
			</div>
		</div>
	</div>

	<script type="module" src="/workflow/static/js/workflow.js"></script>
</body>

</html>